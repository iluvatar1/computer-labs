---
- name: Copying minute maintenance script
  template:
    src: "{{item}}.j2"
    dest: "/{{item}}"
    mode: 0755
  loop:
    - usr/local/bin/minute_maintenance.sh
  register: minutescript

- name: Adding minute_maintenance job
  cron:
    name: "Run useful script every minute"
    minute: "*/1"
    job: "/bin/bash /usr/local/bin/minute_maintenance.sh &>/var/log/minute_maintenance.log"
  register: minutejob

- name: Copying update_motd script
  copy:
    src: "{{item}}"
    dest: "/{{item}}"
    mode: 0755
  loop:
    - usr/local/bin/update_motd.sh
  register: motdscript

- name: Update motd every 5 minutes
  cron:
    name: "Update motd"
    minute: "*/5"
    job: "/bin/bash /usr/local/bin/update_motd.sh &>/var/log/update_motd.log"
  register: motdjob

- name: Copying daily maintenance script
  copy:
    src: "{{item}}"
    dest: "/{{item}}"
  loop:
    - etc/cron.daily/daily_maintenance.sh
  register: daily

- name: Restart service in config changed
  command:
    cmd: /etc/rc.d/rc.crond restart
  when:
    minutescript.changed or minutejob.changed or motdscript.changed or motdjob.changed or daily.changed
 